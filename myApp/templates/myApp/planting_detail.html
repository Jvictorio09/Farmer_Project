{% extends 'base.html' %}
{% block title %}{{ crop.name }} Planting | AgriTrack{% endblock %}

{% block content %}
<div class="bg-green-50 min-h-screen py-6 sm:py-8">
  <div class="mx-auto w-full max-w-5xl px-4 sm:px-6 space-y-6 sm:space-y-8">

    <header class="bg-white rounded-xl shadow px-5 py-6 sm:py-8">
      <div class="flex flex-col gap-2 sm:flex-row sm:items-end sm:justify-between">
        <div>
          <p class="text-xs uppercase tracking-wide text-gray-400">Planting Detail</p>
          <h1 class="text-2xl font-bold text-green-700">{{ crop.name }}</h1>
          <p class="text-sm text-gray-500">
            Logged on <span class="font-medium text-gray-700">{{ activity.date|date:"F j, Y" }}</span> ¬∑
            Field notes: {{ activity.notes|default:"‚Äî" }}
          </p>
        </div>
        <a href="{% url 'activity_log' %}" class="inline-flex items-center text-sm font-medium text-green-600 hover:underline">
          ‚Üê Back to Activity Log
        </a>
      </div>
    </header>

    <section class="grid gap-4 sm:grid-cols-2">
      <div class="bg-white rounded-xl shadow px-4 py-5">
        <h2 class="text-sm font-semibold text-green-700 uppercase tracking-wide">Original Inputs</h2>
        <dl class="mt-3 space-y-2 text-sm text-gray-600">
          <div class="flex justify-between"><dt>Area (ha)</dt><dd class="font-medium text-gray-800">{{ activity.area_ha|default:"‚Äî" }}</dd></div>
          <div class="flex justify-between"><dt>Seed quantity (kg)</dt><dd class="font-medium text-gray-800">{{ activity.seed_qty_kg|default:"‚Äî" }}</dd></div>
          <div class="flex justify-between"><dt>Fertilizer (sacks)</dt><dd class="font-medium text-gray-800">{{ activity.fert_sacks|default:"‚Äî" }}</dd></div>
          <div class="flex justify-between"><dt>Spacing</dt><dd class="font-medium text-gray-800">{{ activity.spacing|default:"‚Äî" }}</dd></div>
        </dl>
      </div>
      <div class="bg-white rounded-xl shadow px-4 py-5">
        <h2 class="text-sm font-semibold text-green-700 uppercase tracking-wide">Crop Baselines</h2>
        <dl class="mt-3 space-y-2 text-sm text-gray-600">
          <div class="flex justify-between"><dt>Seed rate (kg/ha)</dt><dd class="font-medium text-gray-800">{{ baseline.seed_rate_min|floatformat:1 }} ‚Äì {{ baseline.seed_rate_max|floatformat:1 }}</dd></div>
          <div class="flex justify-between"><dt>Fertilizer (sacks/ha)</dt><dd class="font-medium text-gray-800">{{ baseline.fert_sacks_min|floatformat:1 }} ‚Äì {{ baseline.fert_sacks_max|floatformat:1 }}</dd></div>
          <div class="flex justify-between"><dt>Yield potential (t/ha)</dt><dd class="font-medium text-gray-800">{{ baseline.yield_t_min|floatformat:1 }} ‚Äì {{ baseline.yield_t_max|floatformat:1 }}</dd></div>
          <div class="flex justify-between"><dt>Maturity (days)</dt><dd class="font-medium text-gray-800">{{ baseline.harvest_days_min }} ‚Äì {{ baseline.harvest_days_max }}</dd></div>
        </dl>
      </div>
    </section>

    <section class="bg-white rounded-xl shadow px-5 py-6">
      <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
        <h2 class="text-sm font-semibold text-green-700 uppercase tracking-wide">Forecast Snapshot</h2>
        {% if latest_forecast %}
          <p class="text-xs text-gray-500">Last saved: {{ latest_forecast.created_at|date:"M j, Y ‚Ä¢ g:i a" }}</p>
        {% endif %}
      </div>
      <div class="mt-4 grid gap-4 sm:grid-cols-3">
        <div class="rounded-lg border border-gray-100 bg-green-50 px-4 py-4 text-sm">
          <p class="text-xs uppercase tracking-wide text-green-700">Expected Yield</p>
          <p class="mt-1 text-2xl font-bold text-green-800">{{ forecast_snapshot.expected_yield_kg|floatformat:0 }} kg</p>
          <p class="text-xs text-gray-500">Range: {{ forecast_snapshot.yield_min_kg|floatformat:0 }} ‚Äì {{ forecast_snapshot.yield_max_kg|floatformat:0 }} kg</p>
        </div>
        <div class="rounded-lg border border-gray-100 px-4 py-4 text-sm">
          <p class="text-xs uppercase tracking-wide text-gray-500">Harvest Window</p>
          <p class="mt-1 text-sm font-semibold text-gray-800">
            {% if forecast_snapshot.harvest_start %}{{ forecast_snapshot.harvest_start|date:"M j" }}{% else %}?{% endif %}
            ‚Äì
            {% if forecast_snapshot.harvest_end %}{{ forecast_snapshot.harvest_end|date:"M j" }}{% else %}?{% endif %}
          </p>
          <p class="text-xs text-gray-500">Based on crop maturity days.</p>
        </div>
        <div class="rounded-lg border border-gray-100 px-4 py-4 text-sm">
          <p class="text-xs uppercase tracking-wide text-gray-500">Notes</p>
          <p class="mt-1 text-xs leading-relaxed text-gray-600">{{ forecast_snapshot.notes }}</p>
        </div>
      </div>
    </section>

    <section class="grid gap-4 sm:grid-cols-3">
      <div class="bg-white rounded-xl shadow px-4 py-5 text-sm">
        <p class="text-xs uppercase tracking-wide text-green-700">Season Factor</p>
        <p class="mt-2 text-xl font-semibold text-gray-800">{{ forecast_snapshot.season_factor|floatformat:2 }}</p>
        <p class="mt-1 text-xs text-gray-500">
          How close the planting date is to the ideal season for {{ crop.name }}.
        </p>
      </div>
      <div class="bg-white rounded-xl shadow px-4 py-5 text-sm">
        <p class="text-xs uppercase tracking-wide text-green-700">Input Factor</p>
        <p class="mt-2 text-xl font-semibold text-gray-800">{{ forecast_snapshot.input_factor|floatformat:2 }}</p>
        <p class="mt-1 text-xs text-gray-500">
          Compares actual seed and fertilizer rates to crop baselines.
        </p>
      </div>
      <div class="bg-white rounded-xl shadow px-4 py-5 text-sm">
        <p class="text-xs uppercase tracking-wide text-green-700">Population Factor</p>
        <p class="mt-2 text-xl font-semibold text-gray-800">{{ forecast_snapshot.population_factor|floatformat:2 }}</p>
        <p class="mt-1 text-xs text-gray-500">
          Adjusts for plant population based on spacing (tree crops benefit most).
        </p>
      </div>
    </section>

    <section class="bg-white rounded-xl shadow px-5 py-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
      <div>
        <h2 class="text-sm font-semibold text-green-700 uppercase tracking-wide">Need to refresh?</h2>
        <p class="text-xs text-gray-600">
          If you‚Äôve updated crop baselines or corrected inputs, recalculate to refresh the saved forecast.
        </p>
      </div>
      <form method="post" data-confirm="edit" class="flex items-center gap-3">
        {% csrf_token %}
        <input type="hidden" name="recalculate" value="1">
        <button type="submit" class="inline-flex items-center rounded-lg bg-green-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-green-700">
          üîÑ Recalculate Forecast
        </button>
      </form>
    </section>

  </div>
</div>
{% endblock %}

